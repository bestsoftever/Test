name: PR Validation

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]
    branches:
      - master

jobs:
  validate-branch-name:
    runs-on: ubuntu-latest
    steps:
      - name: Validate branch name format
        run: |
          BRANCH="${{ github.head_ref }}"
          echo "Source branch: $BRANCH"
          
          # Check if branch name matches expected patterns
          # Version bumping branches
          if [[ "$BRANCH" =~ ^(breaking|major)[/-] ]]; then
            echo "‚úÖ Valid branch: Major/Breaking change"
            echo "This will bump the MAJOR version (x.0.0)"
          elif [[ "$BRANCH" =~ ^(feat|feature)[/-] ]]; then
            echo "‚úÖ Valid branch: Feature"
            echo "This will bump the MINOR version (0.x.0)"
          elif [[ "$BRANCH" =~ ^(fix|bugfix|patch|hotfix)[/-] ]]; then
            echo "‚úÖ Valid branch: Fix/Patch"
            echo "This will bump the PATCH version (0.0.x)"
          elif [[ "$BRANCH" =~ ^(perf)[/-] ]]; then
            echo "‚úÖ Valid branch: Performance"
            echo "This will bump the PATCH version (0.0.x)"
          # Non-releasing branches
          elif [[ "$BRANCH" =~ ^(chore|build|ci|docs|style|refactor|test|revert)[/-] ]]; then
            echo "‚úÖ Valid branch: $BRANCH"
            echo "‚ö†Ô∏è  This branch type will NOT trigger a new release"
          else
            echo "‚ùå Invalid branch name: $BRANCH"
            echo ""
            echo "Branch name must start with one of the following prefixes:"
            echo ""
            echo "üì¶ Version bumping (will create a release):"
            echo "  - breaking/ or major/     ‚Üí Major version bump (x.0.0)"
            echo "  - feat/ or feature/       ‚Üí Minor version bump (0.x.0)"
            echo "  - fix/, bugfix/, patch/, hotfix/ ‚Üí Patch version bump (0.0.x)"
            echo "  - perf/                   ‚Üí Patch version bump (0.0.x)"
            echo ""
            echo "üîß Non-releasing (no version bump):"
            echo "  - chore/    ‚Üí Maintenance tasks"
            echo "  - build/    ‚Üí Build system changes"
            echo "  - ci/       ‚Üí CI configuration"
            echo "  - docs/     ‚Üí Documentation only"
            echo "  - style/    ‚Üí Code style/formatting"
            echo "  - refactor/ ‚Üí Code refactoring"
            echo "  - test/     ‚Üí Adding/updating tests"
            echo "  - revert/   ‚Üí Reverting changes"
            echo ""
            echo "Examples:"
            echo "  - feat/add-new-feature"
            echo "  - fix/resolve-login-issue"
            echo "  - docs/update-readme"
            echo "  - chore/update-dependencies"
            exit 1
          fi
        shell: bash
